{{/*
 =============================================================================
 ClickHouse Secret Template
 Creates the secret for ClickHouse credentials
 ============================================================================*/}}

{{- if .Values.clickhouse.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.clickhouse.secret.name }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "jamaibase.labels" $ | nindent 4 }}
    app.kubernetes.io/component: clickhouse
  annotations:
    # Helm hook to ensure secret is created before all other ClickHouse resources
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "0"
    "helm.sh/hook-delete-policy": before-hook-creation
    {{- include "jamaibase.annotations" $ | nindent 4 }}
type: Opaque
stringData:
  cluster_secret: {{ .Values.clickhouse.clusterSecret | quote }}
  db_user_password: {{ .Values.clickhouse.dbUserPassword | quote }}
  db_readonly_user_password: {{ .Values.clickhouse.dbReadonlyUserPassword | quote }}
{{- end }}
