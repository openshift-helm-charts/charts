# Default values for expanso-edge-compute

image:
  repository: registry.connect.redhat.com/expanso/expanso-edge
  tag: "2.1.7-ubi9"
  pullPolicy: IfNotPresent

# Expanso Edge configuration
expansoEdge:
  version: "2.1.7"
  nodeType: "compute"
  apiHost: "0.0.0.0"
  apiPort: 1234

  # Local mode: run without control plane connection
  # Automatically enabled when no bootstrap token is provided
  # Can also be explicitly set to true
  localMode: false

  # Bootstrap configuration
  bootstrap:
    url: "https://start.cloud.expanso.io"
    token: ""  # Set via --set or secrets

  # Orchestrator connection
  orchestrators:
    - "nats://expanso-orchestrator:4222"

  # Compute node labels
  labels:
    environment: "production"
    cloud: "openshift"
    marketplace: "redhat"

  # Allowed local paths for workload execution
  allowlistedLocalPaths:
    - "/tmp"

  # Job selection
  jobSelection:
    locality: "anywhere"
    rejectStatelessJobs: false
    acceptNetworkedJobs: true

  # Logging
  logging:
    level: "info"
    mode: "default"

# Kubernetes resources
resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 1000m
    memory: 2Gi

# Security context (container-level; fsGroup belongs in podSecurityContext only)
securityContext:
  runAsNonRoot: true
  runAsUser: 1000

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# Service configuration (optional - for API exposure)
service:
  enabled: true
  type: ClusterIP
  port: 1234
  targetPort: 1234

# ServiceAccount
serviceAccount:
  create: true
  name: ""
  annotations: {}

# Node selector, tolerations, affinity
nodeSelector: {}
tolerations: []
affinity: {}

# Additional environment variables
extraEnv: []

# Pod annotations
podAnnotations: {}

# Replica count (typically 1 per compute node)
replicaCount: 1

# Liveness probe configuration (can be disabled for CI/testing)
livenessProbe:
  enabled: true
  httpGet:
    path: /api/v1/health
    port: api
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Readiness probe configuration (can be disabled for CI/testing)
readinessProbe:
  enabled: true
  httpGet:
    path: /api/v1/health
    port: api
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
